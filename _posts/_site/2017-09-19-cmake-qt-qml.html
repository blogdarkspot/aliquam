<p>Esse é provavelmente o primeiro de alguns outros posts a respeito de configurar um projeto usando CMake. Nesse artigo será as configurações básicas para compilar um projeto usando CMake,Qt e QML, depois testes e por último gerar instaladores.</p>

<h2 id="configurações-mínimas-do-cmake">Configurações Mínimas do CMake</h2>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.0<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>Nome_do_projeto<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_INCLUDE_CURRENT_DIR ON<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_AUTOMOC ON<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE AUTORCC ON<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_STANDARD 14<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>Qt5 COMPONENTS Core Quick REQUIRED<span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span>Executable_name main.cpp layouts/layouts.qrc<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>Executable_name Qt5::Core Qt5::Quick<span class="p">)</span>
</code></pre></div></div>

<p>Na terceira linha é marcadada a variável <a href="https://cmake.org/cmake/help/v3.0/variable/CMAKE_INCLUDE_CURRENT_DIR.html" target="_blank">CMAKE_INCLUDE_CURRENT_DIR</a> como enable para incluir no diretório de build os paths das seguintes variavéis ${CMAKE_CURRENT_SOURCE_DIR} e ${CMAKE_CURRENT_BINARY_DIR}. A quarta linha roda o <a href="http://doc.qt.io/qt-4.8/moc.html" target="_blank">moc</a> automaticamente quando necessário. Para adicionar <a href="doc.qt.io/qt-5/resources.html" target="_blank">Qt Resource System</a> é necessário ativar o <a href="https://cmake.org/cmake/help/v3.0/prop_tgt/AUTORCC.html" target="_blank">CMAKE_AUTORCC</a>, se isso não for marcado como ON os arquivos .qml não serão carregados na hora da compilação. A partir da versão 5.7 do Qt é necessário compilar com suporte ao C++11, com antes da versão 3.1.0 do CMake isso não é marcado por default é possível fazer isso através da variável <a href="https://cmake.org/cmake/help/v3.1/prop_tgt/CXX_STANDARD.html" target="_blank">CMAKE_CXX_STANDARD</a> onde é possível setar 98, 11 ou 14. <a href="https://cmake.org/cmake/help/v3.0/command/find_package.html" target="_blank">find_package</a> é um recurso interessante que ajuda a procurar os includes necessários, para o qml é necessário usar o <a href="http://doc.qt.io/qt-5/qtquick-index.html" target="_blank">QT Quick</a>. Também é necessário adicionar todos os arquivos .qrc junto do <a href="https://cmake.org/cmake/help/v3.0/command/add_executable.html?highlight=add_executable" target="_blank">ADD_EXECUTABLE</a>.</p>

<h2 id="criando-um-hello-world">Criando um Hello World</h2>

<p>Para validar se a configuração esta correta, vamos criar uma espécie de Hello World, só para ver se está tudo Ok.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE RCC&gt;</span><span class="nt">&lt;RCC</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;qresource</span> <span class="na">prefix=</span><span class="s">"/layouts"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>main.qml<span class="nt">&lt;/file&gt;</span>
  <span class="nt">&lt;/qresource&gt;</span>
<span class="nt">&lt;/RCC&gt;</span>  
</code></pre></div></div>

<p>O arquivo acima deve ter a extensão .qrc ele serve para listar todos os Qt Resource System (fotos,ícones,fontes, qml e arquivos em geral) esse é o arquivo que será adicionado no add_executable do cmake após o arquivo main.cpp. No exemplo que eu fiz eu chamei esse arquivo de layouts.qrc e adicionei ele dentro de um subdiretório chamado layouts para melhor organizar, assim no CMake deve ficar layouts/layouts.qrc.</p>

<div class="language-qml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="kt">ApplicationWindow</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kd">root</span>
  <span class="nl">width</span><span class="p">:</span> <span class="mi">300</span>
  <span class="nl">height</span><span class="p">:</span> <span class="mi">300</span>
  <span class="nl">visible</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Esse é o arquivo main.qml que foi listando dentro do arquivo .qrc. Agora é possível carregar esse layout dentro do c++ já que ele está referênciado dentro do .qrc e o arquivo qrc está linkado no executável.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include&lt;QGuiApplication&gt;
#include&lt;QQmlApplicationEngine&gt;
</span>  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">QGuiApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">QQmlApplicationEngine</span> <span class="n">engine</span><span class="p">;</span>
  <span class="n">engine</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="n">QStringLiteral</span><span class="p">(</span><span class="s">"qrc:///layouts/main.qml"</span><span class="p">)));</span>
  <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Essa pequena aplicação carrega o layout feito no .qml, é uma janela em branco, mas com isso sabemos que o CMake está configurado corretamente.</p>

<h2 id="conclusão">Conclusão</h2>

<p>Esse tutorial explica como configurar uma aplicação mínima usando CMake, Qt e QML sem a necessidade de se prender ao QtCreator.</p>
